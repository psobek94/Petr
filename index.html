<!DOCTYPE html>
<html lang="cs">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Investiční portfolio</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      background-color: #f4f4f4;
      font-family: Arial, sans-serif;
    }

    .container {
      max-width: 1600px;
      margin: 20px auto;
    }

    .stock-card {
      margin-bottom: 20px;
    }

    .stock-icon {
      width: 40px;
      height: 40px;
      object-fit: contain;
    }

    .currency-switcher {
      margin-bottom: 20px;
    }
  </style>
</head>

<body>
  <div class="container">
    <h1 class="text-center my-4">Přehled portfolia</h1>
    <div class="currency-switcher text-end">
      <label for="currencySelect">Měna: </label>
      <select id="currencySelect" class="form-select w-auto d-inline-block">
        <option value="CZK">CZK</option>
        <option value="USD">USD</option>
      </select>
    </div>
    <div id="portfolio" class="row"></div>
  </div>

  <script>
    const tickers = ["AAPL", "GOOGL", "AMZN", "MSFT", "AMD", "NVDA", "TSLA", "META", "DELL", "BTI", "O"];
    const currencyRates = { CZK: 1, USD: 0.043 }; // Dynamicky načíst v ostré verzi
    const currencySymbols = { CZK: "Kč", USD: "$" };

    async function fetchStockData(ticker) {
      const url = `https://apidojo-yahoo-finance-v1.p.rapidapi.com/stock/v2/get-summary?symbol=${ticker}&region=US`;
      const options = {
        method: 'GET',
        headers: {
          'X-RapidAPI-Key': '7907cfa146msh6ab915bab585a3bp190de3jsn931308660764',
          'X-RapidAPI-Host': 'apidojo-yahoo-finance-v1.p.rapidapi.com'
        }
      };
      try {
        const response = await fetch(url, options);
        const result = await response.json();
        return {
          ticker,
          name: result.price.longName,
          price: result.price.regularMarketPrice.raw,
          currency: result.price.currency,
          logo: `https://logo.clearbit.com/${result.price.shortName}.com` // Může selhat – nahradit v praxi vlastní URL
        };
      } catch (error) {
        console.error(error);
        return null;
      }
    }

    async function renderPortfolio() {
      const container = document.getElementById("portfolio");
      container.innerHTML = "";

      for (const ticker of tickers) {
        const stock = await fetchStockData(ticker);
        if (!stock) continue;

        const selectedCurrency = document.getElementById("currencySelect").value;
        const conversionRate = currencyRates[selectedCurrency];
        const convertedPrice = (stock.price / currencyRates[stock.currency] * conversionRate).toFixed(2);

        const card = document.createElement("div");
        card.className = "col-md-4 stock-card";
        card.innerHTML = `
          <div class="card shadow-sm">
            <div class="card-body">
              <h5 class="card-title">
                <img src="${stock.logo}" alt="logo" class="stock-icon me-2" onerror="this.style.display='none'">
                ${stock.name} (${stock.ticker})
              </h5>
              <p class="card-text">Aktuální cena: <strong>${convertedPrice} ${currencySymbols[selectedCurrency]}</strong></p>
            </div>
          </div>
        `;
        container.appendChild(card);
      }
    }

    document.getElementById("currencySelect").addEventListener("change", renderPortfolio);
    renderPortfolio();
  </script>
</body>

</html>
